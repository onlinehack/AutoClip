# 🚀 AutoClip Studio - 自动化视频混剪系统 (Audio Driven)

AutoClip Studio 是一个基于 Python 和 Streamlit 的全自动化视频生成工具。它改为**音频驱动 (Audio Driven)** 模式，支持用户上传音频文件（解说/旁白），系统将自动进行语音识别生成字幕（或加载用户提供的字幕），并根据音频时长智能匹配视频素材，一键生成高质量短视频。

## ✨ 功能特性

*   **音频驱动核心**：
    *   直接上传 MP3/WAV/M4A 音频文件作为主轨道，视频时长自动适配音频。
    *   **多音频并发**：支持批量上传多个音频文件，支持批量合成任务。
*   **自动字幕 (FunASR)**：
    *   内置阿里达摩院 FunASR 模型，支持中英文混合高精度识别。
    *   **字幕自定义**：支持上传现成的 SRT 字幕文件，或使用自动生成的字幕，支持"电影级"样式硬烧录。
*   **精细化素材管理**：
    *   **智能混剪**：根据音频时长，自动从多个视频素材文件夹中随机抽取片段进行填充。
    *   **灵活编排**：自定义素材文件夹的**播放顺序**和**时长权重**（百分比）。
    *   **高级抽取设置**：支持**文件夹级独立配置**，可对每个素材文件夹单独设置：
        *   **片段时长范围** (如 2s-5s)
        *   **播放倍速** (Speed)
        *   **抽取间隔** (Skip Gap)
    *   **内存优化**：针对短片段随机抽取进行了内存缓存优化，防止 OOM。
*   **视频后期增强**：
    *   **转场特效**：支持两段视频间添加 **交叉淡入淡出 (Crossfade)** 或 **淡入黑场 (Fade to Black)** 转场效果。
    *   **背景音乐**：支持自动混音 BGM，可从 `assets/bgm` 目录选择。
*   **素材预处理 V2**：
    *   内置一键预处理工具，使用 **Padding (黑边填充)** 模式替代单纯裁剪，完整保留原画内容的同时统一分辨率（如横屏转竖屏自动加黑边）。
    *   **并行加速**：充分利用多核 CPU 进行并行预处理。
*   **多分辨率支持**：TikTok (1080x1920), 横屏 (1920x1080) 及自定义分辨率。
*   **可视化界面**：Streamlit Web 界面，支持生成过程 **UI 锁定**防止误操作，支持生成任务**Tag标签**分类管理。

## 📂 目录结构

```text
moviecut/
├── assets/                 # 素材存放目录
│   ├── video/              # 视频素材（请在此创建子文件夹分类存放）
│   └── bgm/                # 背景音乐 (.mp3, .wav)
├── deploy/                 # 部署相关文件
├── output/                 # 视频生成输出目录
├── src/                    # 核心代码库
│   ├── pipeline.py         # 核心处理流程
│   ├── models.py           # 数据模型
│   ├── processors/         # ASR/Matcher/ASR处理器
├── gui_app.py              # Streamlit 启动入口
├── requirements.txt        # 依赖列表
└── README.md               # 项目说明文档
```

## 🛠️ 安装与运行

### 方式一：本地运行 (Local)

1.  **环境准备**：确保已安装 Python 3.10+ 并安装了 FFmpeg（需配置到 PATH）。
2.  **安装依赖**：
    ```bash
    pip install -r requirements.txt
    ```
3.  **准备素材**：
    *   在 `assets/video/` 下创建子文件夹（例如 `scene1`, `scene2`），并放入视频片段。
    *   在 `assets/bgm/` 下放入背景音乐（可选）。
4.  **启动应用**：
    ```bash
    streamlit run gui_app.py
    ```
    启动后浏览器会自动打开 `http://localhost:8501`。

### 方式二：Docker 部署

详见 `deploy` 目录下的说明或直接构建：

```bash
docker build -t autoclip-studio -f deploy/Dockerfile .
docker run -p 8501:8501 -v $(pwd)/assets:/app/assets -v $(pwd)/output:/app/output autoclip-studio
```

## 📖 使用指南

1.  **上传音频**：在界面左侧上传您的解说音频文件 (MP3/WAV)。
2.  **字幕设置**：
    *   (可选) 上传配套的 SRT 字幕文件。
    *   如果不上传，系统将自动使用 **FunASR** 模型进行语音识别生成字幕。
    *   字幕将以“电影级”样式（高对比度、阴影）硬烧录到视频中。
3.  **配置素材**：
    *   **预处理 (推荐)**：若素材尺寸不统一，建议先使用侧边栏的“素材预处理”工具进行统一（支持 Padding 填充模式）。
    *   **配置权重**：在界面右侧选择参与混剪的素材文件夹。
    *   **高级设置**：展开文件夹下方的详情页，可设置该文件夹素材的**抽取时长范围**、**播放速度**及**跳过间隔**。
    *   **调整权重**：滑动滑块决定该类素材在视频中占据的时长比例。
4.  **全局设置**：
    *   **生成数量**：设置批量生成的视频个数。
    *   **输出目录 Tag**：输入自定义 Tag（如 "Demo_v1"），作为输出文件夹的前缀，便于分类。
    *   **转场效果**：选择视频片段间的转场模式（无 / Crossfade / Fade to Black）及转场时长。
5.  **开始生成**：点击“🎬 开始生成”按钮，UI 将自动锁定防止误触，请耐心等待日志完成。
6.  **预览与导出**：生成完成后，视频将直接在界面展示，文件保存在 `output/[Tag]_YYYYMMDD_HHMMSS/` 目录。

## ⚠️ 注意事项

*   **FFmpeg**：项目依赖 FFmpeg 进行视频合成及字幕烧录，请确保系统已安装。
*   **FunASR模型**：首次运行时会自动下载 FunASR 相关模型（Paraformer, FSMN, CT-Transformer），请保持网络通畅。
*   **素材要求**：视频素材分辨率若不足 1080p，系统会自动填充或 resize 适配，但建议使用高清素材以获最佳效果。

---
Enjoy creating! 🎥
